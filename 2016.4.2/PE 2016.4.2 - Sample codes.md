# Sample puppet code for common tasks

_Note : Remember, we define a_ **state** _in puppet. We do not tell Puppet, how to get to that state._

_For eg. We would say "Hey Puppet, ensure that package 'apache' is installed." Puppet translates it to relevant commands based on the system it is running on. So on a RHEL-based system, Puppet would run_ **something like** _a ```yum list installed | grep apache``` and if the output is nothing then do something like ```yum install apache```._

_Imp thing to note is, Puppet doesn't exactly know what "apache" is. All it knows is the state for a node i.e. in this case, "the node must have a package called apache". Puppet's job is to intelligently translate that_ **state definition** _to a system level command and give you the result of the command execution. So, if the actual package name for Apache is "apache2",_ **you** _will have to tell that to Puppet._

## [File related](https://docs.puppet.com/puppet/4.7/types/file.html)

### Create a file
  
  ```
  file { '/tmp/testfile' :
  ensure => file,  
  }
  
  # Checks if file '/tmp/testfile' exists else creates one.
  # Values "present" does the same. "directory" will create a directory. "absent" will delete.
  ``` 

  - Examples with more options
  
  ```
  file { 'random_data_file' :  # This part 'random_data_file' is called the title.
    path   => '/tmp/random_filename_with_very_long_name_to_put_in_title',
    ensure => file,
    owner  => 'root',
    group  => 'root',
    mode   => '0750',
    content => "Hello world",
  }
  
  # 'path' attribute can be used instead of writing the long name in title.
  ```
  
  ```
  file { '/tmp/symlink_to_hostsfile':
    ensure => 'link',  
    target => '/etc/hosts',
  }
  
  # creates a symlink to /etc/hosts.
  ```

  ```
  file { '/tmp/special_msg_file.txt':
    ensure => file , 
    source => 'puppet://modules/<your module name>/hello_world.txt', 
    }
    
  # your module will have a file named "hello_world.txt" under <your module name>/files/. 
  # This file will be copied to /tmp as "special_msg_file.txt" with default file permissions.
  ```



## [Package related](https://docs.puppet.com/puppet/4.7/types/package.html)

### Install a package
  
  ```
  package { 'emacs' :
  ensure => installed, 
  }
  
  # Checks if the package 'emacs' is installed, else installs it.
  # Values "latest" will install ensure the latest version is installed. 
  #"absent" will remove the package. "purged" will remove pkg and config files
  ```
  - Installing multiple packages with more options
  
  ```
  $pkg_list = [ 'bash', 'curl' ]
  
  package { $pkg_list :
  ensure => installed,
  install_options => ['--enablerepo', 'my_repo'], 
  }
  
  # you can send special options to the command
  ```

## [Service related](https://docs.puppet.com/puppet/4.7/types/service.html)

### Start a service

  ```
  service { 'httpd' :
  ensure => running,  # "stopped" will stop it.
  enable => true,     # "true" - start service at boot. "false" to NOT start at boot.
  }
  
  # Works exactly like 'service httpd start', if it is not already running.
  ```

  - Restart a service everytime a particular file changes
  
 
  ```
  service { 'apache service' :
  name => $::osfamily?       
        {
         'Debian' => 'apache2',
         'RedHat' => 'httpd',
         default => 'apache',
         }
    # a condition to set service name based on type of OS. "osfamily" is fact btw. 
    # you can do a "facter osfmaily" on the node to see what its value is.     
  ensure => running,
  enable => true,
  subscribe => File['apache_config_file'], 
  # Service "subscribes" to a File resource in the manifest. 
  # Meaning the Service will restart everytime the file resource "apache_config_file" changes. 
  # You will be defining this "apache_config_file" file resource somwhere in the manifest. 
  # Typically that file resource will set the right configuration of apache.
  }
  ```



## [User](https://docs.puppet.com/puppet/4.7/types/user.html)/[Group](https://docs.puppet.com/puppet/4.7/types/group.html) related

### Create a user
  
  ```
  user { 'foo':
  ensure     => 'present',  # "absent" deletes the user.
  }
  ```
  
  - Example with more options
  
  ```
  user { 'Pop star':
  name    => 'michealj', # You can use this to mention the actual system username instead of the title.
  ensure  => present, # quotes around present is optional, since they are keywords.
  home    => '/data/foo', # home directory of user foo.
  gid     => '1003', # its primary group ID.
  groups  => ['sysadmins','worldsavers'] # you can mention the groups it is part of.
  shell   => '/bin/zsh', # default shell.
  comment => 'The pop star user to amange our systems.', # description of the user
  }
  ```


---
_inspired by www.puppetcookbook.com_
